var scriptElements=document.getElementsByTagName("script"),i,element,myfile,myurl,assetsDir;for(i=0;element=scriptElements[i];i++)if(myfile=element.src,myfile.indexOf("filemanager.js")>=0)var myurl=myfile.substring(0,myfile.indexOf("filemanager.js"));var string=myurl,arr=string.split("/");assetsDir=arr[arr.length-4]+"/"+arr[arr.length-3],function(e){e.richFilemanagerPlugin=function(t,i){function r(t,i){if(-1===_.indexOf(i))return!1;if("select"===i&&"folder"===t.type)return!1;if("replace"===i&&"folder"===t.type)return!1;if("extract"===i){var r=ne(t.attributes.name);return"file"===t.type&&"zip"===r}return"download"===i&&"folder"===t.type?C.options.allowFolderDownload===!0:"undefined"!=typeof t.attributes.capabilities?e.inArray(i,t.attributes.capabilities)>-1:!0}function o(){C.filetree.enabled&&(g.show(),m.splitter({sizeLeft:C.filetree.width,minLeft:C.filetree.minWidth,minRight:200}),E.treeModel.loadNodes(null,!1))}function n(){E.itemsModel.loadList(M)}function s(){return window.opener||window.parent&&window.self!==window.parent||window.tinyMCEPopup||I.param("field_name")||I.param("CKEditor")||I.param("ImperaviElementId")}function a(e){return e.attributes.readable?("file"===e.type&&E.previewModel.applyObject(e),void(("folder"===e.type||"parent"===e.type)&&(E.previewFile(!1),E.itemsModel.loadList(e.id)))):(c.error(x.NOT_ALLOWED_SYSTEM),!1)}function l(e){var t=!E.clipboardModel.enabled(),i={select:{name:x.action_select,className:"select"},download:{name:x.action_download,className:"download"},rename:{name:x.action_rename,className:"rename"},move:{name:x.action_move,className:"move"},replace:{name:x.action_replace,className:"replace"},separator1:"-----",copy:{name:x.clipboard_copy,className:"copy"},cut:{name:x.clipboard_cut,className:"cut"},"delete":{name:x.action_delete,className:"delete"},extract:{name:x.action_extract,className:"extract"}};return r(e,"download")||delete i.download,r(e,"select")&&s()||delete i.select,r(e,"rename")&&C.options.browseOnly!==!0||delete i.rename,r(e,"delete")&&C.options.browseOnly!==!0||delete i["delete"],r(e,"extract")&&C.options.browseOnly!==!0||delete i.extract,(!r(e,"copy")||C.options.browseOnly===!0||t)&&delete i.copy,(!r(e,"move")||C.options.browseOnly===!0||t)&&(delete i.cut,delete i.move),delete i.replace,i}var d={baseUrl:"./"+assetsDir,config:{},callbacks:{beforeCreateImageUrl:function(e,t){return t},beforeCreatePreviewUrl:function(e,t){return t},beforeSelectItem:function(e,t){return t},afterSelectItem:function(e,t,i){}}},c=this,u=e(t),p=u.children(".fm-wrapper"),f=p.find(".fm-header"),h=f.find(".fm-uploader"),m=p.children(".fm-splitter"),v=p.children(".fm-footer"),b=m.children(".fm-fileinfo"),g=m.children(".fm-filetree"),w=b.find(".view-items-wrapper"),y=b.find(".fm-preview-wrapper"),j=w.find(".view-items"),k=h.children(".fm-upload"),C=null,x=null,M="/",S=null,_=[],O=null,F=null,E=null,N=null,I=purl(),T=(new Date).getTime();c.settings=e.extend(!0,d,i),c.log=function(t,i){var r=alertify,o=e.extend({},{reset:!0,delay:5e3,logMaxItems:5,logPosition:"bottom right",logContainerClass:"fm-log",parent:e(".fm-popup").is(":visible")?document.body:b[0],onClick:void 0,unique:!1,type:"log"},i);return o.logClass&&o.unique&&e(".fm-log").children("."+o.logClass).length>0?r:(o.reset&&r.reset(),o.parent&&r.parent(o.parent),r.logDelay(o.delay),r.logMaxItems(o.logMaxItems),r.logPosition(o.logPosition),r.logContainerClass(o.logContainerClass),r[o.type](t,o.onClick),r)},c.error=function(t,i){return c.log(t,e.extend({},{type:"error",delay:1e4},i))},c.warning=function(t,i){return c.log(t,e.extend({},{type:"warning",delay:1e4},i))},c.success=function(t,i){return c.log(t,e.extend({},{type:"success",delay:6e3},i))},c.alert=function(e){alertify.reset().dialogContainerClass("fm-popup").alert(e)},c.confirm=function(e){alertify.reset().dialogWidth(e.width).dialogPersistent(e.persistent).dialogContainerClass("fm-popup").confirm(e.message,e.okBtn,e.cancelBtn)},c.prompt=function(e){alertify.reset().dialogWidth(e.width).dialogPersistent(e.persistent).dialogContainerClass("fm-popup").theme(e.template).prompt(e.message,e.value||"",e.okBtn,e.cancelBtn)},c.dialog=function(e){alertify.reset().dialogWidth(e.width).dialogPersistent(e.persistent).dialogContainerClass("fm-popup").dialog(e.message,e.buttons)},c.setDimensions=function(){var t=p.outerHeight(!0)-p.height(),i=e(window).height()-f.height()-v.height()-t,r=m.width()-m.children(".splitter-bar-vertical").outerWidth()-g.outerWidth();m.height(i),b.width(r)};var L=function(){var t=e.Deferred();t.then(function(){return P()}).then(function(e,t){return U()}).then(function(){return D()}).then(function(){return z()}).then(function(){A(function(){B()})}),t.resolve()},P=function(){return e.when(Q("default"),Q("user")).done(function(t,i){var r=t[0],o=i[0];if(void 0!==o&&null!==o&&delete o.version,C=e.extend({},r,o),C.api.connectorUrl)S=C.api.connectorUrl;else{var n=location.origin+location.pathname,s=assetsDir+"/connector/filemanager.php";ne(n).length>0&&(n=n.substring(0,n.lastIndexOf("/")+1)),S=n+s}try{void 0!==c.settings.config.api.connectorUrl&&""!=J(c.settings.config.api.connectorUrl)&&(S=c.settings.config.api.connectorUrl)}catch(a){}})},U=function(){return e.ajax({type:"GET",url:ge({mode:"initiate"}),dataType:"json"}).done(function(t){if(t.data){var i=t.data.attributes.config;e.each(i,function(t,i){e.each(i,function(e,i){void 0===C[t]&&(C[t]=[]),C[t][e]=i})})}Y(t)}).fail(function(){c.error("Unable to perform initial request to server.")}).then(function(t){return t.errors?e.Deferred().reject():void 0})},D=function(){function t(e){return r+e+".json"}var i=I.param("langCode"),r=c.settings.baseUrl+"/languages/";try{void 0!==c.settings.config.options.culture&&""!=J(c.settings.config.options.culture)&&(i=c.settings.config.options.culture)}catch(o){}return e.ajax().then(function(){return i?q(t(i)).done(function(){C.options.culture=i}).fail(function(){setTimeout(function(){c.error("Given language file ("+t(i)+") does not exist!")},500)}):void 0}).then(function(){return e.ajax({type:"GET",url:t(C.options.culture),dataType:"json"}).done(function(e){x=e})})},z=function(){return e.when(G("upload-container"),G("upload-item")).done(function(e,t){var i=e[0],r=t[0];p.append(i).append(r)})},A=function(e){var t,i,r=[],o=[];t=C.options.theme;try{void 0!==c.settings.config.options.theme&&""!=J(c.settings.config.options.culture)&&(t=c.settings.config.options.theme)}catch(n){}r.push("/themes/"+t+"/styles/theme.css"),C.customScrollbar.enabled&&(r.push("/scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.min.css"),r.push("/scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js"));try{void 0!==c.settings.config.customScrollbar.enabled&&""!=J(c.settings.config.customScrollbar.enabled)&&(1==c.settings.config.customScrollbar.enabled?(r.push("/scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.min.css"),r.push("/scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js")):(i=r.indexOf("/scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.min.css"),i>-1&&r.splice(i,1),i=r.indexOf("/scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js"),i>-1&&r.splice(i,1)))}catch(n){}if(r.push(e),W(r),C.viewer.editable.enabled){var s=C.viewer.editable.theme;s&&"default"!==s&&o.push("/scripts/CodeMirror/theme/"+s+".css"),o.push("/scripts/CodeMirror/lib/codemirror.css"),o.push("/scripts/CodeMirror/lib/codemirror.js"),o.push("/scripts/CodeMirror/addon/selection/active-line.js"),o.push("/scripts/CodeMirror/addon/display/fullscreen.css"),o.push("/scripts/CodeMirror/addon/display/fullscreen.js")}try{if(void 0!==c.settings.config.viewer.editable.enabled&&""!=J(c.settings.config.viewer.editable.enabled)){try{var s=c.settings.config.viewer.editable.theme;void 0!==s&&""!=J(s)&&s&&"default"!==s&&o.push("/scripts/CodeMirror/theme/"+s+".css")}catch(n){}1==c.settings.config.viewer.editable.enabled?(o.push("/scripts/CodeMirror/lib/codemirror.css"),o.push("/scripts/CodeMirror/lib/codemirror.js"),o.push("/scripts/CodeMirror/addon/selection/active-line.js"),o.push("/scripts/CodeMirror/addon/display/fullscreen.css"),o.push("/scripts/CodeMirror/addon/display/fullscreen.js")):(i=r.indexOf("/scripts/CodeMirror/lib/codemirror.css"),i>-1&&r.splice(i,1),i=r.indexOf("/scripts/CodeMirror/lib/codemirror.js"),i>-1&&r.splice(i,1),i=r.indexOf("/scripts/CodeMirror/addon/selection/active-line.js"),i>-1&&r.splice(i,1),i=r.indexOf("/scripts/CodeMirror/addon/display/fullscreen.css"),i>-1&&r.splice(i,1),i=r.indexOf("/scripts/CodeMirror/addon/display/fullscreen.js"),i>-1&&r.splice(i,1))}}catch(n){}C.viewer.markdownRenderer.enabled&&(o.push("/styles/fm-markdown.css"),o.push("/scripts/markdown-it/markdown-it.min.js"),o.push("/scripts/markdown-it/default.min.css"),o.push("/scripts/markdown-it/highlight.min.js"),o.push("/scripts/markdown-it/markdown-it-footnote.min.js"),o.push("/scripts/markdown-it/markdown-it-replace-link.min.js"));try{void 0!==c.settings.config.viewer.markdownRenderer.enabled&&""!=J(c.settings.config.viewer.markdownRenderer.enabled)&&(1==c.settings.config.viewer.markdownRenderer.enabled?(o.push("/styles/fm-markdown.css"),o.push("/scripts/markdown-it/markdown-it.min.js"),o.push("/scripts/markdown-it/default.min.css"),o.push("/scripts/markdown-it/highlight.min.js"),o.push("/scripts/markdown-it/markdown-it-footnote.min.js"),o.push("/scripts/markdown-it/markdown-it-replace-link.min.js")):(i=r.indexOf("/styles/fm-markdown.css"),i>-1&&r.splice(i,1),i=r.indexOf("/scripts/markdown-it/markdown-it.min.js"),i>-1&&r.splice(i,1),i=r.indexOf("/scripts/markdown-it/default.min.css"),i>-1&&r.splice(i,1),i=r.indexOf("/scripts/markdown-it/highlight.min.js"),i>-1&&r.splice(i,1),i=r.indexOf("/scripts/markdown-it/markdown-it-footnote.min.js"),i>-1&&r.splice(i,1),i=r.indexOf("/scripts/markdown-it/markdown-it-replace-link.min.js"),i>-1&&r.splice(i,1)))}catch(n){}C.options.browseOnly||(o.push("/scripts/jQuery-File-Upload/js/vendor/jquery.ui.widget.js"),o.push("/scripts/jQuery-File-Upload/js/canvas-to-blob.min.js"),o.push("/scripts/jQuery-File-Upload/js/load-image.all.min.js"),o.push("/scripts/jQuery-File-Upload/js/jquery.iframe-transport.js"),o.push("/scripts/jQuery-File-Upload/js/jquery.fileupload.js"),o.push("/scripts/jQuery-File-Upload/js/jquery.fileupload-process.js"),o.push("/scripts/jQuery-File-Upload/js/jquery.fileupload-image.js"),o.push("/scripts/jQuery-File-Upload/js/jquery.fileupload-validate.js"),C.upload.multiple&&o.push("/scripts/jQuery-File-Upload/css/dropzone.css"));try{if(void 0!==c.settings.config.options.browseOnly&&""!=J(c.settings.config.options.browseOnly))if(0==c.settings.config.options.browseOnly){o.push("/scripts/jQuery-File-Upload/js/vendor/jquery.ui.widget.js"),o.push("/scripts/jQuery-File-Upload/js/canvas-to-blob.min.js"),o.push("/scripts/jQuery-File-Upload/js/load-image.all.min.js"),o.push("/scripts/jQuery-File-Upload/js/jquery.iframe-transport.js"),o.push("/scripts/jQuery-File-Upload/js/jquery.fileupload.js"),o.push("/scripts/jQuery-File-Upload/js/jquery.fileupload-process.js"),o.push("/scripts/jQuery-File-Upload/js/jquery.fileupload-image.js"),o.push("/scripts/jQuery-File-Upload/js/jquery.fileupload-validate.js");try{void 0!==c.settings.config.upload.multiple&&""!=J(c.settings.config.upload.multiple)&&(1==c.settings.config.upload.multiple?o.push("/scripts/jQuery-File-Upload/css/dropzone.css"):(i=r.indexOf("/scripts/jQuery-File-Upload/css/dropzone.css"),i>-1&&r.splice(i,1)))}catch(n){}}else i=r.indexOf("/scripts/jQuery-File-Upload/js/vendor/jquery.ui.widget.js"),i>-1&&r.splice(i,1),i=r.indexOf("/scripts/jQuery-File-Upload/js/canvas-to-blob.min.js"),i>-1&&r.splice(i,1),i=r.indexOf("/scripts/jQuery-File-Upload/js/load-image.all.min.js"),i>-1&&r.splice(i,1),i=r.indexOf("/scripts/jQuery-File-Upload/js/jquery.iframe-transport.js"),i>-1&&r.splice(i,1),i=r.indexOf("/scripts/jQuery-File-Upload/js/jquery.fileupload.js"),i>-1&&r.splice(i,1),i=r.indexOf("/scripts/jQuery-File-Upload/js/jquery.fileupload-process.js"),i>-1&&r.splice(i,1),i=r.indexOf("/scripts/jQuery-File-Upload/js/jquery.fileupload-image.js"),i>-1&&r.splice(i,1),i=r.indexOf("/scripts/jQuery-File-Upload/css/dropzone.css"),i>-1&&r.splice(i,1)}catch(n){}o.length&&W(o)},B=function(){_=C.options.capabilities||["upload","select","download","rename","copy","move","delete","extract","replace"];var t=[];C.options.fileSorting&&(t=C.options.fileSorting.toLowerCase().split("_")),O=t[0]||"name",F=t[1]||"asc";var i=I.param("exclusiveFolder");i&&(M="/"+i+"/",M=oe(M));var r=I.param("expandedFolder");if(r&&(N=M+r+"/",N=oe(N)),E=new R,ko.applyBindings(E),ko.bindingHandlers.toggleNodeVisibility={init:function(t,i){var r=i();e(t).toggle(r.isExpanded())},update:function(t,i){var r=i();return r.isSliding()===!1?!1:(r.isExpanded()===!1&&e(t).slideDown(C.filetree.expandSpeed,function(){r.isSliding(!1),r.isExpanded(!0)}),void(r.isExpanded()===!0&&e(t).slideUp(C.filetree.expandSpeed,function(){r.isSliding(!1),r.isExpanded(!1)})))}},ko.bindingHandlers.draggableView={init:function(e,t,i){E.ddModel.makeDraggable(t(),e)}},ko.bindingHandlers.droppableView={init:function(e,t,i){E.ddModel.makeDroppable(t(),e)}},ko.bindingHandlers.draggableTree={init:function(e,t,i){E.ddModel.makeDraggable(t(),e)}},ko.bindingHandlers.droppableTree={init:function(e,t,i){E.ddModel.makeDroppable(t(),e)}},p.mousewheel(function(t){if(!E.ddModel.dragHelper)return!1;var i,r=null;if(i=C.customScrollbar.enabled?e([w[0],g[0]]):m.children(".splitter-pane"),i.each(function(i){var o=e(this),n=o.offset().top,s=o.offset().left;return t.offsetY>=n&&t.offsetY<=n+o.height()&&t.offsetX>=s&&t.offsetX<=s+o.width()?(r=o,!1):void 0}),null===r)return!1;if(C.customScrollbar.enabled){var o=r.find(".mCSB_scrollTools_vertical"),n=1===t.deltaY?"+":"-";o.is(":visible")&&r.mCustomScrollbar("scrollTo",[n+"=250",0],{scrollInertia:500,scrollEasing:"easeOut",callbacks:!0})}else if(r[0].scrollHeight>r[0].clientHeight){var s=r.scrollTop(),a=s-200*t.deltaY;E.ddModel.isScrolling=!0,a=0>a?0:a,r.stop().animate({scrollTop:a},100,"linear",function(){E.ddModel.isScrolling=!1,E.ddModel.isScrolled=!0})}}),j.selectable({filter:"li:not(.directory-parent), tbody > tr:not(.directory-parent)",cancel:".directory-parent, thead",disabled:!C.manager.selection.enabled,appendTo:j,start:function(e,t){xe(),E.itemsModel.isSelecting(!0)},stop:function(e,t){E.itemsModel.isSelecting(!1)},selected:function(e,t){var i=ko.dataFor(t.selected);i.selected(!0)},unselected:function(e,t){var i=ko.dataFor(t.unselected);i.selected(!1)}}),b.contextMenu({selector:".view-items",zIndex:10,build:function(e,t){var i={createFolder:{name:x.create_folder,className:"create-folder"},paste:{name:x.clipboard_paste,className:"paste",disabled:function(e,t){return E.clipboardModel.isEmpty()}}};return E.clipboardModel.enabled()&&C.options.browseOnly!==!0||delete i.paste,{appendTo:".fm-container",items:i,reposition:!1,callback:function(e,t){switch(e){case"createFolder":E.headerModel.createFolder();break;case"paste":E.clipboardModel.paste()}}}}}),C.extras.extra_js)for(var s=0;s<C.extras.extra_js.length;s++)e.ajax({type:"GET",url:C.extras.extra_js[s],dataType:"script",async:C.extras.extra_js_async});I.param("popUp")&&(E.headerModel.closeButton(!0),E.headerModel.closeButtonOnClick=function(){parent.$("#fm-bs-modal").modal("toggle")}),I.param("CKEditorCleanUpFuncNum")&&(E.headerModel.closeButton(!0),E.headerModel.closeButtonOnClick=function(){parent.CKEDITOR.tools.callFunction(I.param("CKEditorCleanUpFuncNum"))}),e("#newfile").change(function(){e("#filepath").val(e(this).val().replace(/.+[\\\/]/,""))}),o(),n(),Re(),C.customScrollbar.enabled&&(g.mCustomScrollbar({theme:C.customScrollbar.theme,scrollButtons:{enable:C.customScrollbar.button},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0},callbacks:{onScrollStart:function(){E.ddModel.isScrolling=!0},onScroll:function(){E.ddModel.isScrolling=!1}},axis:"yx"}),y.mCustomScrollbar({theme:C.customScrollbar.theme,scrollButtons:{enable:C.customScrollbar.button},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0,updateOnSelectorChange:".fm-preview-viewer"}}),w.mCustomScrollbar({theme:C.customScrollbar.theme,scrollButtons:{enable:C.customScrollbar.button},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0,updateOnSelectorChange:".grid, .list"},callbacks:{onScrollStart:function(){E.itemsModel.continiousSelection()||(this.yStartPosition=this.mcs.top,this.yStartTime=(new Date).getTime()),E.ddModel.isScrolling=!0},onScroll:function(){E.ddModel.isScrolling=!1,E.ddModel.isScrolled=!0},whileScrolling:function(){if(C.manager.selection.enabled){var e=(new Date).getTime()-this.yStartTime;!E.itemsModel.continiousSelection()&&e>400&&(this.yStartPosition=this.mcs.top),E.itemsModel.isSelecting()&&E.itemsModel.continiousSelection(!0);var t=Math.abs(this.mcs.top)-Math.abs(this.yStartPosition);j.selectable("repositionCssHelper",t,0)}}},axis:"y",alwaysShowScrollbar:0}));var a=document.documentElement;if(a.setAttribute("data-useragent",navigator.userAgent),C.options.logger){var l=(new Date).getTime(),d=l-T;console.log("Total execution time : "+d+" ms")}var f=u.find(".fm-loading-wrap");f.fadeOut(800,function(){c.setDimensions()}),c.setDimensions()},R=function(){var t=this;this.config=ko.observable(C),this.lg=ko.observable(x),this.localizeGUI=ko.observable(C.options.localizeGUI),this.loadingView=ko.observable(!0),this.previewFile=ko.observable(!1),this.viewMode=ko.observable(C.options.defaultViewMode),this.currentPath=ko.observable(M),this.browseOnly=ko.observable(C.options.browseOnly),this.previewModel=ko.observable(null),this.previewFile.subscribe(function(e){e||(t.previewModel.closeEditor(),t.itemsModel.descriptivePanel.rdo().id===t.previewModel.rdo().id&&t.itemsModel.descriptivePanel.render(t.previewModel.viewer.content()))}),this.addItem=function(e,t){var i=E.treeModel.findByParam("id",t);if(i){var r=E.treeModel.createNode(e);E.treeModel.addNodes(i,r)}E.currentPath()===t&&E.itemsModel.addNew(e)},this.removeItem=function(e){var t=E.treeModel.findByParam("id",e.id);t&&t.remove();var i=E.itemsModel.findByParam("id",e.id);i&&i.remove()};var i=function(){var e=this;this.rdo=ko.observable({}),this.cdo=ko.observable({}),this.viewer={type:ko.observable("default"),isEditable:ko.observable(!1),url:ko.observable(null),pureUrl:ko.observable(null),options:ko.observable({}),content:ko.observable(null),codeMirror:ko.observable(null)},this.renderer=new g,this.editor=new w,this.rdo.subscribe(function(t){e.cdo({isFolder:"folder"===t.type,sizeFormatted:K(t.attributes.size),dimensions:t.attributes.width?t.attributes.width+"x"+t.attributes.height:null})}),this.editor.content.subscribe(function(t){e.editor.isInteractive()&&e.renderer.render(t)}),this.applyObject=function(i){t.previewFile(!1);var r=i.attributes.name,o={interactive:!1},n={type:"default",url:null,options:{}};e.rdo(i),ue(r)&&(n.type="image",n.url=ye(i,!1,!0)),fe(r)&&C.viewer.audio.enabled===!0&&(n.type="audio",n.url=we(i,!0)),pe(r)&&C.viewer.video.enabled===!0&&(n.type="video",n.url=we(i,!0),n.options={width:C.viewer.video.playerWidth,height:C.viewer.video.playerHeight}),he(r)&&C.viewer.opendoc.enabled===!0&&(n.type="opendoc",n.url=c.settings.baseUrl+"/scripts/ViewerJS/index.html#"+we(i,!0),n.options={width:C.viewer.opendoc.readerWidth,height:C.viewer.opendoc.readerHeight}),me(r)&&C.viewer.google.enabled===!0&&(n.type="google",n.url="http://docs.google.com/viewer?url="+encodeURIComponent(we(i,!1))+"&embedded=true",n.options={width:C.viewer.google.readerWidth,height:C.viewer.google.readerHeight}),(ve(r)&&C.viewer.codeMirrorRenderer.enabled===!0||be(r)&&C.viewer.markdownRenderer.enabled===!0)&&(n.type="renderer",e.renderer.setRenderer(i),o.interactive=e.renderer.renderer().interactive),e.viewer.type(n.type),e.viewer.url(n.url),e.viewer.options(n.options),e.viewer.pureUrl(ue(r)?ye(i,!1,!1):we(i,!1)),e.viewer.isEditable(ce(r)&&C.viewer.editable.enabled===!0),e.editor.isInteractive(o.interactive),"renderer"===n.type||e.viewer.isEditable()?Le(i).then(function(i){if(i.data){var r=i.data.attributes.content;e.viewer.content(r),t.previewFile(!0)}}):t.previewFile(!0)},ZeroClipboard.config({swfPath:c.settings.baseUrl+"/scripts/zeroclipboard/dist/ZeroClipboard.swf"}),this.afterRender=function(){e.renderer.render(e.viewer.content());var t=new ZeroClipboard(y.find(".btn-copy-url")[0]);t.on("ready",function(e){t.on("aftercopy",function(e){c.success(x.copied)})})},this.initiateEditor=function(t){var i=y.find(".fm-cm-editor-content")[0];e.editor.createInstance(e.rdo().attributes.extension,i,{readOnly:!1,styleActiveLine:!0})},this.bindToolbar=function(t){r(e.rdo(),t)&&Be(t,e.rdo())},this.previewIconClass=ko.pureComputed(function(){var t=[],i=["ico"];return"default"!==e.viewer.type()&&e.viewer.url()||(t.push("grid-icon"),this.cdo().isFolder===!0?(t.push("ico_folder"),i.push("folder"),this.rdo().attributes.readable||i.push("lock")):(t.push("ico_file"),this.rdo().attributes.readable?i.push("ext",this.rdo().attributes.extension):i.push("file","lock")),t.push(i.join("_"))),t.join(" ")},this),this.editFile=function(){var t=e.viewer.content();e.renderer.render(t),e.editor.render(t)},this.saveFile=function(){Pe(e.rdo())},this.closeEditor=function(){e.editor.enabled(!1),e.renderer.render(e.viewer.content())},this.buttonVisibility=function(t){switch(t){case"select":return r(e.rdo(),t)&&s();case"move":case"rename":case"delete":case"replace":return r(e.rdo(),t)&&C.options.browseOnly!==!0;case"download":return r(e.rdo(),t)}}},o=function(){var i=this;this.selectedNode=ko.observable(null),this.treeData={id:M,level:ko.observable(-1),children:ko.observableArray([])},this.treeData.children.subscribe(function(e){i.arrangeNode(i.treeData)});var r=function(e){if(null!==N){e||(e=i.treeData);var t=i.findByFilter(function(e){return 0===N.indexOf(e.id)},e);t?(C.filetree.expandSpeed=10,i.loadNodes(t,!1)):(N=null,C.filetree.expandSpeed=200)}};this.findByParam=function(e,t,r){if(!r&&(r=i.treeData,r[e]===t))return r;var o=r.children();if(!o||0===o.length)return null;for(var n=0,s=o.length;s>n;n++){if(o[n][e]===t)return o[n];var a=i.findByParam(e,t,o[n]);if(a)return a}return null},this.findByFilter=function(e,t){if(!t&&(t=i.treeData,e(t)))return t;var r=t.children();if(!r||0===r.length)return null;for(var o=0,n=r.length;n>o;o++){if(e(r[o]))return r[o];var s=i.findByFilter(e,r[o]);if(s)return s}return null},this.loadNodes=function(t,o){var n=t?t.id:i.treeData.id;t&&t.isLoaded(!1);var s={mode:"getfolder",path:n};I.param("type")&&(s.type=I.param("type")),e.ajax({type:"GET",url:ge(s),dataType:"json",cache:!1,success:function(n){if(n.data){var s=[];e.each(n.data,function(e,t){var r=i.createNode(t);s.push(r)}),o&&t.children([]),i.addNodes(t,s),t&&(t.isLoaded(!0),i.expandNode(t)),r(t)}Y(n)},error:$})},this.createNode=function(e){return new o(e)},this.addNodes=function(t,r){e.isArray(r)||(r=[r]),t||(t=i.treeData),C.filetree.foldersOnly&&(r=e.grep(r,function(e){return e.cdo.isFolder})),e.each(r,function(e,i){i.parentNode(t)});var o=t.children().concat(r);t.children(H(o))},this.expandNode=function(e){return e.isExpanded()===!1&&e.isLoaded()===!0?(e.isSliding(!0),!0):!1},this.collapseNode=function(e){return e.isExpanded()===!0?(e.isSliding(!0),!0):!1},this.toggleNode=function(e){i.collapseNode(e)||i.expandNode(e)},this.arrangeNode=function(t){var i=t.children().length;e.each(t.children(),function(e,r){r.level(t.level()+1),r.isFirstNode(0===e),r.isLastNode(e===i-1)})},this.nodeRendered=function(t,i){e(t[1]).contextMenu({selector:".file, .directory",zIndex:100,build:function(e,t){return i.selected(!0),{appendTo:".fm-container",items:l(i.rdo),callback:function(e,t){Be(e,i.rdo)}}}})},this.actualizeNodeObject=function(t,r,o){var n=new RegExp("^"+r),s=t.rdo.id,a=s.replace(n,o);t.id=a,t.rdo.id=a,t.rdo.attributes.path=t.rdo.attributes.path.replace(new RegExp(s+"$"),a),t.children().length&&e.each(t.children(),function(e,t){i.actualizeNodeObject(t,r,o)})};var o=function(r){var o=this;this.ancestor=i,this.id=r.id,this.rdo=r,this.cdo={isFolder:"folder"===r.type,dimensions:r.attributes.width?r.attributes.width+"x"+r.attributes.height:null,cssItemClass:"folder"===r.type?"directory":"file"},this.nodeTitle=ko.observable(r.attributes.name),this.children=ko.observableArray([]),this.parentNode=ko.observable(null),this.isSliding=ko.observable(!1),this.isLoading=ko.observable(!1),this.isLoaded=ko.observable(!1),this.isExpanded=ko.observable(!1),this.selected=ko.observable(!1),this.dragHovered=ko.observable(!1),this.level=ko.observable(0),this.isFirstNode=ko.observable(!1),this.isLastNode=ko.observable(!1),this.nodeTitle.subscribe(function(e){o.rdo.attributes.name=e}),this.children.subscribe(function(e){i.arrangeNode(o)}),this.isLoaded.subscribe(function(e){o.isLoading(!e)}),this.selected.subscribe(function(e){e?(null!==i.selectedNode()&&i.selectedNode().selected(!1),i.selectedNode(o),t.itemsModel.unselectItems()):i.selectedNode(null)}),this.switchNode=function(e){return e.cdo.isFolder?e.rdo.attributes.readable?void(e.isLoaded()?i.toggleNode(e):o.openNode(e)):(c.error(x.NOT_ALLOWED_SYSTEM),!1):!1},this.mouseDown=function(e,t){e.selected(!0)},this.nodeClick=function(e,t){C.manager.dblClickOpen||o.openNode(e)},this.nodeDblClick=function(e,t){C.manager.dblClickOpen&&o.openNode(e)},this.openNode=function(t,r){if("file"===t.rdo.type&&a(t.rdo),"folder"===t.rdo.type)if(!t.isLoaded()||t.isExpanded()&&C.filetree.reloadOnClick)i.loadNodes(t,!0),a(t.rdo);else{i.toggleNode(t),E.currentPath(t.id),E.breadcrumbsModel.splitCurrent();var o=[];e.each(t.children(),function(e,t){o.push(t.rdo)}),E.itemsModel.setList(o)}},this.remove=function(){o.parentNode().children.remove(o)},this.isRoot=function(){return o.level()===i.treeData.id},this.title=ko.pureComputed(function(){return C.options.showTitleAttr?this.rdo.id:null},this),this.itemClass=ko.pureComputed(function(){var e=[];return this.selected()&&C.manager.selection.enabled&&e.push("ui-selected"),this.dragHovered()&&e.push(t.ddModel.hoveredCssClass),e.join(" ")},this),this.iconClass=ko.pureComputed(function(){var e,t=["ico"];return this.cdo.isFolder===!0?(e="ico_folder",this.isLoading()===!0?t.push("loading"):(t.push("folder"),this.rdo.attributes.readable?(this.isExpanded()||!this.isExpanded()&&this.isSliding())&&t.push("open"):t.push("lock"))):(e="ico_file",this.rdo.attributes.readable?t.push("ext",this.rdo.attributes.extension):t.push("file","lock")),e+" "+t.join("_")},this),this.switcherClass=ko.pureComputed(function(){var e=[];if(C.filetree.showLine?0===this.level()&&this.isFirstNode()&&this.isLastNode()?e.push("root"):0==this.level()&&this.isFirstNode()?e.push("roots"):this.isLastNode()?e.push("bottom"):e.push("center"):e.push("noline"),this.cdo.isFolder){var t=this.isExpanded()||!this.isExpanded()&&this.isSliding();e.push(t?"open":"close")}else e.push("docu");return e.join("_")},this),this.clusterClass=ko.pureComputed(function(){return C.filetree.showLine&&!this.isLastNode()?"line":""},this)}},n=function(){function i(e){return C.manager.selection.enabled&&C.manager.selection.useCtrlKey&&e.ctrlKey===!0?!1:C.manager.dblClickOpen&&"click"===e.type?!1:!0}var o=this;this.objects=ko.observableArray([]),this.objectsSize=ko.observable(0),this.objectsNumber=ko.observable(0),this.selectedNumber=ko.observable(0),this.listSortField=ko.observable(O),this.listSortOrder=ko.observable(F),this.isSelecting=ko.observable(!1),this.continiousSelection=ko.observable(!1),this.descriptivePanel=new g,this.isSelecting.subscribe(function(e){e||o.continiousSelection(!1)}),this.createObject=function(e){return new n(e)},this.addNew=function(i){var r=t.itemsModel.objects();e.isArray(i)||(i=[i]),e.each(i,function(e,t){r.push(o.createObject(t))}),r=H(r),t.itemsModel.objects.valueHasMutated()},this.loadList=function(i){t.loadingView(!0);var r={mode:"getfolder",path:i};I.param("type")&&(r.type=I.param("type")),e.ajax({type:"GET",url:ge(r),dataType:"json",cache:!1,success:function(e){e.data&&(t.currentPath(i),t.breadcrumbsModel.splitCurrent(),t.itemsModel.setList(e.data)),Y(e)},error:$})},this.setList=function(r){var n=[];if(!X(t.currentPath())&&t.currentPath()!==M){var s=le(t.currentPath()),a={id:s,rdo:{id:s,type:"parent",attributes:{readable:!0,writable:!0}},dragHovered:ko.observable(!1)};a.open=function(e,t){i(t)&&o.loadList(a.id)},a.itemClass=ko.pureComputed(function(){var e=[];return a.dragHovered()&&e.push(t.ddModel.hoveredCssClass),e.join(" ")}),n.push(a)}o.descriptivePanel.content(null),e.each(r,function(e,t){C.manager.renderer.position&&"string"==typeof C.manager.renderer.indexFile&&t.attributes.name.toLowerCase()===C.manager.renderer.indexFile.toLowerCase()&&(o.descriptivePanel.setRenderer(t),Le(o.descriptivePanel.rdo()).then(function(e){e.data&&o.descriptivePanel.render(e.data.attributes.content)})),n.push(o.createObject(t))}),t.itemsModel.objects(H(n)),t.loadingView(!1)},this.findByParam=function(e,i){return ko.utils.arrayFirst(t.itemsModel.objects(),function(t){return t[e]===i})},this.findByFilter=function(e,t){var i=!t,r=[],n=o.objects();if(!n||0===n.length)return null;for(var s=0,a=n.length;a>s;s++)if(e(n[s])){if(i)return n[s];r.push(n[s])}return i?null:r},this.sortObjects=function(){var e=H(o.objects());o.objects(e)},this.getSelected=function(){var e=o.findByFilter(function(e){return"parent"!==e.rdo.type&&e.selected()},!0);return o.selectedNumber(e.length),e},this.unselectItems=function(t){var i=C.manager.selection.enabled&&C.manager.selection.useCtrlKey&&t===!0;i||e.each(o.getSelected(),function(e,t){t.selected(!1)})},this.objects.subscribe(function(t){var i=0,r=0;e.each(t,function(e,t){"parent"!==t.rdo.type&&i++,"file"===t.rdo.type&&(r+=Number(t.rdo.attributes.size))}),o.objectsNumber(i),o.objectsSize(K(r)),j.contextMenu({selector:".file, .directory",zIndex:100,build:function(t,i){var r=ko.dataFor(t[0]);return r.selected()||(E.itemsModel.unselectItems(!1),r.selected(!0)),{appendTo:".fm-container",items:l(r.rdo),callback:function(t,i){var o=[];e.each(E.itemsModel.getSelected(),function(e,t){o.push(t.rdo)}),Be(t,r.rdo,o)}}}})});var n=function(e){var n=C.viewer.image.thumbMaxWidth;e.attributes.width&&e.attributes.width<n&&(n=e.attributes.width),this.ancestor=o,this.id=e.id,this.rdo=e,this.cdo={isFolder:"folder"===e.type,sizeFormatted:K(e.attributes.size),dimensions:e.attributes.width?e.attributes.width+"x"+e.attributes.height:null,cssItemClass:"folder"===e.type?"directory":"file",imageUrl:ye(e,!0,!0),previewWidth:n},this.visible=ko.observable(!0),this.selected=ko.observable(!1),this.dragHovered=ko.observable(!1),this.selected.subscribe(function(e){e&&null!==t.treeModel.selectedNode()&&t.treeModel.selectedNode().selected(!1)}),this.title=ko.pureComputed(function(){return C.options.showTitleAttr?this.rdo.id:null},this),this.itemClass=ko.pureComputed(function(){var e=[];return this.selected()&&C.manager.selection.enabled&&e.push("ui-selected"),this.dragHovered()&&e.push(t.ddModel.hoveredCssClass),this.cdo.cssItemClass+" "+e.join(" ")},this),this.listIconClass=ko.pureComputed(function(){var e,t=["ico"];return this.cdo.isFolder===!0?(e="ico_folder",t.push("folder"),this.rdo.attributes.readable||t.push("lock")):(e="ico_file",this.rdo.attributes.readable?t.push("ext",this.rdo.attributes.extension):t.push("file","lock")),e+" "+t.join("_")},this),this.gridIconClass=ko.pureComputed(function(){var e=[],t=["ico"];return this.cdo.imageUrl||(e.push("grid-icon"),this.cdo.isFolder===!0?(e.push("ico_folder"),t.push("folder"),this.rdo.attributes.readable||t.push("lock")):(e.push("ico_file"),this.rdo.attributes.readable?t.push("ext",this.rdo.attributes.extension):t.push("file","lock")),e.push(t.join("_"))),e.join(" ")},this),this.mouseDown=function(e,i){e.selected()||E.itemsModel.unselectItems(i.ctrlKey),t.selectionModel.unselect=e.selected(),e.selected(!0)},this.open=function(e,o){t.selectionModel.unselect&&(o.ctrlKey&&e.selected(!1),!o.ctrlKey&&C.manager.dblClickOpen&&(E.itemsModel.unselectItems(o.ctrlKey),e.selected(!0))),i(o)&&(C.options.quickSelect&&"file"===e.rdo.type&&r(e.rdo,"select")?Me(e.rdo):a(e.rdo));
},this.remove=function(){o.objects.remove(this)}}},d=function(){var e=function(e){var i=this;this.column=ko.observable(e),this.order=ko.observable(t.itemsModel.listSortOrder()),this.sortClass=ko.pureComputed(function(){var e;return t.itemsModel.listSortField()===i.column()&&(e="sorted sorted-"+this.order()),e},this),this.sort=function(){var e="asc"===i.order(),r=t.itemsModel.listSortField()===i.column();i.order(r?e?"desc":"asc":t.itemsModel.listSortOrder()),t.itemsModel.listSortField(i.column()),t.itemsModel.listSortOrder(i.order()),t.itemsModel.sortObjects()}};this.thName=new e("name"),this.thType=new e("type"),this.thSize=new e("size"),this.thDimensions=new e("dimensions"),this.thModified=new e("modified")},f=function(){this.closeButton=ko.observable(!1),this.closeButtonOnClick=function(){console.log("clicked")},this.goHome=function(){t.previewFile(!1),t.itemsModel.loadList(M)},this.goParent=function(){var e=t.previewFile()?ae(t.previewModel.rdo().id):le(t.currentPath());t.previewFile()&&t.previewFile(!1),e!==t.currentPath()&&t.itemsModel.loadList(e)},this.displayGrid=function(){t.viewMode("grid"),t.previewFile(!1)},this.displayList=function(){t.viewMode("list"),t.previewFile(!1)},this.createFolder=function(){var t=function(t,i){var r=i.getInputValue();return r?void e.ajax({type:"GET",url:ge({mode:"addfolder",path:E.currentPath(),name:r}),dataType:"json",success:function(e){e.data&&(E.addItem(e.data,E.currentPath()),i.closeDialog(),C.options.showConfirmation&&c.success(x.successful_added_folder)),Y(e)},error:$}):void c.error(x.no_foldername)};c.prompt({message:x.prompt_foldername,value:x.default_foldername,okBtn:{label:x.create_folder,autoClose:!1,click:t},cancelBtn:{label:x.cancel}})}},h=function(){this.files=ko.observable(null),this.folders=ko.observable(null),this.size=ko.observable(null),this.enabled=ko.observable(!1),this.doSummarize=function(){De()}},m=function(){var i=this;this.value=ko.observable(""),this.findAll=function(r,o){var n=200,s=!0;i.value(o.target.value),ke(function(){var r=s?i.value().toLowerCase():i.value();e.each(t.itemsModel.objects(),function(e,t){if("parent"!==t.rdo.type){var i=t.rdo.attributes.name;s&&(i=i.toLowerCase());var o=0===i.indexOf(r);t.visible(o)}})},n)},this.reset=function(r,o){i.value(""),e.each(t.itemsModel.objects(),function(e,t){t.visible(!0)})}},v=function(){function e(){i=[],r=null}var i=[],r=null,o=this,n=_.indexOf("copy")>-1||_.indexOf("move")>-1;this.enabled=ko.observable(t.config().options.clipboard&&n),this.copy=function(){o.hasCapability("copy")&&(r="copy",i=t.itemsModel.getSelected())},this.cut=function(){o.hasCapability("cut")&&(r="cut",i=t.itemsModel.getSelected())},this.paste=function(){if(o.hasCapability("paste")){if(null===r||0===i.length)return void c.warning(x.clipboard_empty);var n=t.currentPath();Ce(i,function(e,t){return"cut"===r?Ee(t,n):"copy"===r?Fe(t,n):void 0},e)}},this.clear=function(){o.hasCapability("clear")&&(e(),c.success(x.clipboard_cleared))},this.isEmpty=function(){return 0===i.length},this.hasCapability=function(e){if(!o.enabled)return!1;switch(e){case"copy":return _.indexOf("copy")>-1;case"cut":return _.indexOf("move")>-1;default:return!0}}},b=function(){var e=this;this.items=ko.observableArray([]),this.add=function(t,r){e.items.push(new i(t,r))},this.splitCurrent=function(){var i=M,r=t.currentPath(),o=r.replace(new RegExp("^"+M),"").split("/");for(e.items([]),e.add(M,"");o.length>0;){var n=o.shift();n&&(i+=n+"/",e.add(i,n))}};var i=function(e,i){var r=this;this.path=e,this.label=i,this.isRoot=e===M,this.active=e===t.currentPath(),this.itemClass=function(){var e=["nav-item"];return r.isRoot&&e.push("root"),r.active&&e.push("active"),e.join(" ")},this["goto"]=function(e,i){e.active||t.itemsModel.loadList(e.path)}}},g=function(){var t,i=this;this.rdo=ko.observable({}),this.content=ko.observable(null),this.renderer=ko.observable(null),this.render=function(e){i.renderer()&&i.renderer().processContent(e)},this.setRenderer=function(e){i.rdo(e),be(e.attributes.name)?i.renderer(new o):i.renderer(new r)},this.setContainer=function(r){e.each(r,function(){return e(this).hasClass("fm-renderer-container")?(t=e(this),!1):void 0}),i.renderer().processDomElements(t)};var r=function(){this.name="codeMirror",this.interactive=!1;var e=new w;this.processContent=function(t){e.render(t),i.content(t)},this.processDomElements=function(t){if(!e.instance){var r=t.find(".fm-cm-renderer-content")[0];e.createInstance(i.rdo().attributes.extension,r,{readOnly:"nocursor",styleActiveLine:!1,lineNumbers:!1})}}},o=function(){function r(){t.find("a").each(function(){var t=e(this).attr("href"),i=E.previewModel.editor;if(i.enabled()&&i.isInteractive())e(this).off("click"),e(this).on("click",function(){return!1});else{if(-1!=t.search("://")||ie(t,"mailto:"))return;be(t)&&e(this).on("click",function(e){return Ue(t).then(function(e){e.data&&a(e.data)}),!1})}})}this.name="markdown",this.interactive=!0;var o=window.markdownit({html:!0,linkify:!0,typographer:!0,highlight:function(e,t){if(t&&hljs.getLanguage(t))try{return'<pre class="highlight"><code>'+hljs.highlight(t,e,!0).value+"</code></pre>"}catch(i){}return'<pre class="highlight"><code>'+md.utils.escapeHtml(e)+"</code></pre>"},replaceLink:function(e,t){if(-1!=e.search("://")||ie(e,"mailto:"))return e;var r=ie(e,"/")?M:ae(i.rdo().id),o=r+ee(e,"/");return be(o)?o:ge({mode:"readfile",path:o})}}).use(window.markdownitReplaceLink);this.processContent=function(e){var t=o.render(e);i.content(t),r()},this.processDomElements=function(e){}}},w=function(){function t(e){r.enabled(!0),r.instance.setValue(e),setTimeout(function(){r.instance.refresh()},0)}function i(e){var t=[],i="default";C.viewer.editable.codeHighlight&&("js"===e&&(t.push("/scripts/CodeMirror/mode/javascript/javascript.js"),i="javascript"),"css"===e&&(t.push("/scripts/CodeMirror/mode/css/css.js"),i="css"),"html"===e&&(t.push("/scripts/CodeMirror/mode/xml/xml.js"),i="text/html"),"xml"===e&&(t.push("/scripts/CodeMirror/mode/xml/xml.js"),i="application/xml"),"php"===e&&(t.push("/scripts/CodeMirror/mode/htmlmixed/htmlmixed.js"),t.push("/scripts/CodeMirror/mode/xml/xml.js"),t.push("/scripts/CodeMirror/mode/javascript/javascript.js"),t.push("/scripts/CodeMirror/mode/css/css.js"),t.push("/scripts/CodeMirror/mode/clike/clike.js"),t.push("/scripts/CodeMirror/mode/php/php.js"),i="application/x-httpd-php"),"java"===e&&(t.push("/scripts/CodeMirror/mode/clike/clike.js"),i="text/x-java"),"sql"===e&&(t.push("/scripts/CodeMirror/mode/sql/sql.js"),i="text/x-mysql"),"md"===e&&(t.push("/scripts/CodeMirror/addon/mode/overlay.js"),t.push("/scripts/CodeMirror/mode/xml/xml.js"),t.push("/scripts/CodeMirror/mode/markdown/markdown.js"),t.push("/scripts/CodeMirror/mode/gfm/gfm.js"),t.push("/scripts/CodeMirror/mode/javascript/javascript.js"),t.push("/scripts/CodeMirror/mode/css/css.js"),t.push("/scripts/CodeMirror/mode/htmlmixed/htmlmixed.js"),t.push("/scripts/CodeMirror/mode/clike/clike.js"),t.push("/scripts/CodeMirror/mode/shell/shell.js"),t.push("/scripts/CodeMirror/mode/meta.js"),i="gfm"),"sh"===e&&(t.push("/scripts/CodeMirror/addon/mode/overlay.js"),t.push("/scripts/CodeMirror/mode/markdown/markdown.js"),t.push("/scripts/CodeMirror/mode/gfm/gfm.js"),t.push("/scripts/CodeMirror/mode/javascript/javascript.js"),t.push("/scripts/CodeMirror/mode/css/css.js"),t.push("/scripts/CodeMirror/mode/htmlmixed/htmlmixed.js"),t.push("/scripts/CodeMirror/mode/clike/clike.js"),t.push("/scripts/CodeMirror/mode/meta.js"),t.push("/scripts/CodeMirror/mode/shell/shell.js"),i="shell")),t.length?(t.push(function(){r.mode(i)}),W(t)):r.mode(i)}var r=this,o=null;this.instance=null,this.enabled=ko.observable(!1),this.content=ko.observable(null),this.mode=ko.observable(null),this.isInteractive=ko.observable(!1),this.mode.subscribe(function(e){e&&(r.instance.setOption("mode",e),o&&(t(o),o=null))}),this.render=function(e){r.mode()?t(e):o=e},this.createInstance=function(t,o,n){var s,a={readOnly:"nocursor",styleActiveLine:!1,viewportMargin:1/0,lineNumbers:C.viewer.editable.lineNumbers,lineWrapping:C.viewer.editable.lineWrapping,theme:C.viewer.editable.theme,matchBrackets:C.viewer.editable.matchBrackets,extraKeys:{F11:function(e){e.setOption("fullScreen",!e.getOption("fullScreen"))},Esc:function(e){e.getOption("fullScreen")&&e.setOption("fullScreen",!1)}}};s=CodeMirror.fromTextArea(o,e.extend({},a,n)),s.on("changes",function(e,t){r.content(e.getValue())}),r.instance=s,i(t)}},k=function(){function i(t){var i=e.grep(s.items,function(e,i){if("folder"===t.rdo.type||"parent"===t.rdo.type){if(ie(t.rdo.id,e.rdo.id))return!0;if(t.rdo.id===de(e.rdo.id))return!0}return e.id===t.id});return t.rdo.attributes.writable&&0===i.length}function r(e){if(e.ancestor===t.treeModel)return[E.treeModel.selectedNode()];if(e.ancestor===t.itemsModel)return E.itemsModel.getSelected();throw new Error("Unknown item type.")}function o(e){null!==s.hoveredItem&&s.hoveredItem.dragHovered(!1),s.hoveredItem=e,e&&e.dragHovered(!0)}function n(e,t){t?e.addClass(a):e.removeClass(a)}var s=this,a="drop-restricted",l=e("#drag-helper-template");this.items=[],this.hoveredItem=null,this.dragHelper=null,this.isScrolling=!1,this.isScrolled=!1,this.hoveredCssClass="drop-hover",this.makeDraggable=function(t,i){("file"===t.rdo.type||"folder"===t.rdo.type)&&e(i).draggable({distance:3,cursor:"pointer",cursorAt:{left:Math.floor(l.width()/2),bottom:15},scroll:!1,appendTo:p,containment:u,refreshPositions:!1,helper:function(){var e,i;return i=r(t).length>1?"ico_multiple":"folder"===t.rdo.type?"ico_folder":"ico_file ico_ext_"+ne(t.rdo.id),e=l.children(".drag-helper").clone(),e.find(".clip").addClass(i),s.dragHelper=e,e},start:function(e,i){s.items=r(t)},drag:function(t,i){e(this).draggable("option","refreshPositions",s.isScrolling||s.isScrolled),s.isScrolled=!1},stop:function(e,t){s.items=[],s.dragHelper=null}})},this.makeDroppable=function(r,a){("folder"===r.rdo.type||"parent"===r.rdo.type)&&e(a).droppable({tolerance:"pointer",enableExtendedEvents:r.ancestor===t.itemsModel,accept:function(e){var t=ko.dataFor(e[0]),i=t?t.rdo.type:null;return"file"===i||"folder"===i},over:function(e,t){setTimeout(function(){o(null),n(t.helper,!1),i(r)||n(t.helper,!0),o(r)},0)},out:function(e,t){o(null),n(t.helper,!1)},drop:function(e,t){return o(null),i(r)?void Ce(s.items,function(e,t){return Ee(t.rdo,r.id)}):!1}})}},S=function(){this.unselect=!1};this.treeModel=new o,this.itemsModel=new n,this.tableViewModel=new d,this.previewModel=new i,this.headerModel=new f,this.summaryModel=new h,this.searchModel=new m,this.clipboardModel=new v,this.breadcrumbsModel=new b,this.ddModel=new k,this.selectionModel=new S},H=function(e){function t(e){var t,i=O;switch("list"===E.viewMode()&&(i=E.itemsModel.listSortField()),i){case"type":t=e.rdo.attributes.extension||"";break;case"size":t=e.rdo.attributes.size;break;case"modified":t=e.rdo.attributes.timestamp;break;case"dimensions":t=e.cdo.dimensions||"";break;default:t=e.rdo.attributes.name}return"string"==typeof t&&(s.cases||(t=t.toLowerCase()),t=t.replace(/\s+/g," ")),t}function i(e,t){for(var i=r(e.toString()),o=r(t.toString()),n=0;i[n]&&o[n];n++)if(i[n]!==o[n]){var s=Number(i[n]),a=Number(o[n]);return s==i[n]&&a==o[n]?s-a:i[n]>o[n]?1:-1}return i.length-o.length}function r(e){for(var t,i,r=[],o=0,n=-1,s=0;t=(i=e.charAt(o++)).charCodeAt(0);){var a=46==t||t>=48&&57>=t;a!==s&&(r[++n]="",s=a),r[n]+=i}return r}var o,n="list"===E.viewMode()?E.itemsModel.listSortOrder():F,s={natural:!0,order:"asc"===n?1:-1,cases:!1};e.length>0&&"parent"===e[0].rdo.type&&(o=e.shift()),e.sort(function(e,r){var o,n=t(e),a=t(r);return o=n===a?0:void 0===n||void 0===a?0:s.natural&&(isNaN(n)||isNaN(a))?i(n,a):a>n?-1:n>a?1:0,o*=s.order});for(var a=[],l=e.length;l--;)"folder"===e[l].rdo.type&&(a.push(e[l]),e.splice(l,1));"top"!==C.options.folderPosition&&a.reverse();for(var d=0,c=a.length;c>d;d++)"top"===C.options.folderPosition?e.unshift(a[d]):e.push(a[d]);return o&&e.unshift(o),e},q=function(t){return e.ajax({type:"HEAD",url:t})},Q=function(t){var i=null;return t="undefined"==typeof t?"user":t,i="user"===t?I.param("config")?c.settings.baseUrl+"/config/"+I.param("config"):c.settings.baseUrl+"/config/filemanager.config.json":c.settings.baseUrl+"/config/filemanager.config.default.json",e.ajax({type:"GET",url:i,dataType:"json",cache:!1,error:function(e){c.error("Given config file ("+i+") does not exist!")}})},W=function(e){for(var t=0,i=e.length;i>t;t++)"string"==typeof e[t]&&(e[t]=c.settings.baseUrl+e[t]);toast.apply(this,e)},G=function(t,i){return e.ajax({type:"GET",url:c.settings.baseUrl+"/scripts/templates/"+t+".html",error:$})},K=function(e,t){if(!e)return"";t=t||!1;for(var i=parseFloat(e),r=parseFloat(t?1e3:1024),o=0,n=[x.unit_bytes,x.unit_kb,x.unit_mb,x.unit_gb];;){if(r>i)return i=Math.round(100*i)/100,i+" "+n[o];i/=r,o+=1}},V=function(t){var i;return x&&x[t.message]?(i=x[t.message],e.each(t.arguments,function(e,t){i=i.replace("%s",t)})):i=t.message,i},$=function(e){C.options.logger&&console.log(e.responseText||e),c.error(x.ERROR_SERVER),c.error(e.responseText)},Y=function(t){t.errors&&(C.options.logger&&console.log(t.errors),e.each(t.errors,function(e,t){c.error(V(t))}))},Z=function(t){var i=ne(t);return""===i&&C.security.allowNoExtension===!0?!0:"DISALLOW_ALL"==C.upload.policy&&-1!==e.inArray(i,C.upload.restrictions)?!0:"ALLOW_ALL"==C.upload.policy&&-1===e.inArray(i,C.upload.restrictions)?!0:!1},X=function(e){return"/"!==e.charAt(e.length-1)},J=function(e,t){var i=new RegExp("^"+t+"+|"+t+"+$","g");return e.replace(i,"")},ee=function(e,t){var i=new RegExp("^"+t+"+","g");return e.replace(i,"")},te=function(e,t){var i=new RegExp(t+"+$","g");return e.replace(i,"")},ie=function(e,t,i){return i=i||0,e.substr(i,t.length)===t},re=function(t){var i=[];return e.each(t.split("/"),function(e,t){i.push(encodeURIComponent(t))}),i.join("/")},oe=function(e){return e.replace(/\\/g,"/").replace(/\/+/g,"/")},ne=function(e){return 1===e.split(".").length?"":e.split(".").pop().toLowerCase()},se=function(e){return-1!==e.lastIndexOf(".")?e.substring(0,e.lastIndexOf(".")):e},ae=function(e){return e.lastIndexOf("/")!==e.length-1?e.substr(0,e.lastIndexOf("/")+1):e},le=function(e){return e.split("/").reverse().slice(2).reverse().join("/")+"/"},de=function(e){return e.substring(0,e.slice(0,-1).lastIndexOf("/"))+"/"},ce=function(t){return-1!==e.inArray(ne(t),C.viewer.editable.extensions)},ue=function(t){return-1!==e.inArray(ne(t),C.viewer.image.extensions)},pe=function(t){return-1!==e.inArray(ne(t),C.viewer.video.extensions)},fe=function(t){return-1!==e.inArray(ne(t),C.viewer.audio.extensions)},he=function(t){return-1!==e.inArray(ne(t),C.viewer.opendoc.extensions)},me=function(t){return-1!==e.inArray(ne(t),C.viewer.google.extensions)},ve=function(t){return-1!==e.inArray(ne(t),C.viewer.codeMirrorRenderer.extensions)},be=function(t){return-1!==e.inArray(ne(t),C.viewer.markdownRenderer.extensions)},ge=function(t){var i={time:(new Date).getTime()},r=e.extend({},t||{},i);return-1!=S.indexOf("?")?S+"&"+e.param(r):S+"?"+e.param(r)},we=function(e,t){var i,r,o=e.attributes.path;try{void 0!==c.settings.config.viewer.absolutePath&&"boolean"==typeof c.settings.config.viewer.absolutePath&&(r=c.settings.config.viewer.absolutePath)}catch(n){r=C.viewer.absolutePath}return r&&o?(t&&(o=re(o)),i=je(o,!1)):i=ge({mode:"readfile",path:e.id}),i=c.settings.callbacks.beforeCreatePreviewUrl(e,i)},ye=function(e,t,i){var r;if(ue(e.id)&&e.attributes.readable&&(t&&C.viewer.image.showThumbs||!t&&C.viewer.image.enabled===!0)){var o;try{void 0!==c.settings.config.viewer.absolutePath&&"boolean"==typeof c.settings.config.viewer.absolutePath&&(o=c.settings.config.viewer.absolutePath)}catch(n){o=C.viewer.absolutePath}if(o&&!t&&e.attributes.path)r=je(re(e.attributes.path),i);else{var s={path:e.id};"svg"===e.attributes.extension?s.mode="readfile":(s.mode="getimage",t&&(s.thumbnail="true")),r=ge(s)}r=c.settings.callbacks.beforeCreateImageUrl(e,r)}return r},je=function(e,t){var i;try{void 0!==c.settings.config.viewer.previewUrl&&""!=J(c.settings.config.viewer.previewUrl)&&(i="string"==typeof c.settings.config.viewer.previewUrl?c.settings.config.viewer.previewUrl:location.origin)}catch(r){var i="string"==typeof C.viewer.previewUrl?C.viewer.previewUrl:location.origin}return i=J(i,"/")+e,t&&(i+="?time="+(new Date).getTime()),i},ke=function(){var e=0;return function(t,i){clearTimeout(e),e=setTimeout(t,i)}}(),Ce=function(t,i,r){var o=0,n=t.length,s=e.Deferred().resolve();e.each(t,function(e,t){s=s.then(function(){return i(e,t)}).then(function(e){e&&e.data&&o++})}),n>1&&s.then(function(){c.log(x.successful_processed.replace("%s",o).replace("%s",n))}),s.then(function(){"function"==typeof r&&r()})},xe=function(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var e=window.getSelection();e.removeAllRanges()}},Me=function(e){var t=null,i=we(e,!0);if(i=c.settings.callbacks.beforeSelectItem(e,i),pathToFileOnly="boolean"==typeof c.settings.config.viewer.pathToFileOnly,void 0!==c.settings.config.viewer.previewUrl&&1==pathToFileOnly&&1==c.settings.config.viewer.pathToFileOnly&&1==c.settings.config.viewer.absolutePath){var r=c.settings.config.viewer.previewUrl;i=i.substring(r.length)}if(window.tinyMCEPopup){var o=tinyMCEPopup.getWindowArg("window");return o.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=i,"undefined"!=typeof o.ImageDialog&&(o.ImageDialog.getImageData&&o.ImageDialog.getImageData(),o.ImageDialog.showPreviewImage&&o.ImageDialog.showPreviewImage(i)),void tinyMCEPopup.close()}if(I.param("field_name")&&(parent.document.getElementById(I.param("field_name")).value=i,"undefined"!=typeof parent.tinyMCE&&parent.tinyMCE.activeEditor.windowManager.close(),"undefined"!=typeof parent.$.fn.colorbox&&parent.$.fn.colorbox.close()),I.param("ImperaviElementId"))if(window.opener);else{var n=I.param("ImperaviElementId"),s=parent.$("#"+n).redactor("core.getObject");s&&(s.modal.close(),s.buffer.set(),ue(e.attributes.name)?s.insert.html('<img src="'+i+'">'):s.insert.html('<a href="'+i+'">'+e.attributes.name+"</a>"))}if(I.param("CKEditor")&&(window.opener?window.opener.CKEDITOR.tools.callFunction(I.param("CKEditorFuncNum"),i):(parent.CKEDITOR.tools.callFunction(I.param("CKEditorFuncNum"),i),parent.CKEDITOR.tools.callFunction(I.param("CKEditorCleanUpFuncNum")))),window.opener&&"function"==typeof window.opener.SetUrl)if(e.attributes.width){var a=i,l=e.attributes.width,d=e.attributes.height;window.opener.SetUrl(a,l,d)}else window.opener.SetUrl(i);window.opener&&(t=window.opener),window.parent&&window.self!==window.parent&&(t=window.parent),t&&t.postMessage({source:"richfilemanager",preview_url:i},"*"),c.settings.callbacks.afterSelectItem(e,i,t)},Se=function(t){var i=function(i,r){var o=t.id,n=r.getInputValue();if(!n)return void c.error(x.new_filename);if(!C.options.allowChangeExtensions){var s=ne(t.attributes.name);s.length>0&&(n=n+"."+s)}if(X(o)&&!Z(n)){var a="<p>"+x.INVALID_FILE_TYPE+"</p>";return"DISALLOW_ALL"==C.upload.policy&&(a+="<p>"+x.ALLOWED_FILE_TYPE.replace("%s",C.upload.restrictions.join(", "))+".</p>"),"ALLOW_ALL"==C.upload.policy&&(a+="<p>"+x.DISALLOWED_FILE_TYPE.replace("%s",C.upload.restrictions.join(", "))+".</p>"),e("#filepath").val(""),void c.error(a)}e.ajax({type:"GET",url:ge({mode:"rename",old:o,"new":n}),dataType:"json",success:function(e){if(e.data){var t=e.data,i=E.treeModel.findByParam("id",o);if(i&&("folder"===i.rdo.type&&(i.nodeTitle(t.attributes.name),E.treeModel.actualizeNodeObject(i,o,t.id)),"file"===i.rdo.type)){var n=i.parentNode(),s=E.treeModel.createNode(t);i.remove(),n&&E.treeModel.addNodes(n,s)}var a=E.itemsModel.findByParam("id",o);a&&("parent"===a.rdo.type?a.id=t.id:(a.remove(),E.itemsModel.addNew(t))),E.currentPath()===o&&E.itemsModel.loadList(t.id),E.previewFile()&&E.previewModel.rdo().id===o&&E.previewModel.applyObject(t),r.closeDialog(),C.options.showConfirmation&&c.success(x.successful_rename)}Y(e)},error:$})};c.prompt({message:x.new_filename,value:C.options.allowChangeExtensions?t.attributes.name:se(t.attributes.name),okBtn:{label:x.action_rename,autoClose:!1,click:i},cancelBtn:{label:x.cancel}})},_e=function(t){var i=e("#fm-js-preview-toolbar"),r=i.find(":file");"undefined"==typeof i.data("blueimpFileupload")&&i.fileupload({autoUpload:!0,dataType:"json",url:ge(),paramName:"files"}).on("fileuploadadd",function(e,i){var r=i.files[0];return ne(r.name)!=t.attributes.extension?(c.error(x.ERROR_REPLACING_FILE.replace("%s","."+t.attributes.extension)),!1):void i.submit()}).on("fileuploadsubmit",function(e,i){i.formData={mode:"replace",path:t.id},k.addClass("loading").prop("disabled",!0),k.children("span").text(x.loading_data)}).on("fileuploadalways",function(e,t){k.removeData().removeClass("loading").prop("disabled",!1),k.children("span").text(x.action_upload);var i=t.result;if(i&&i.errors&&c.error(x.upload_failed+"<br>"+V(i.errors[0])),i&&i.data){var r=i.data[0];E.removeItem(r),E.addItem(r,E.currentPath()),E.previewFile()&&E.previewModel.applyObject(r),C.options.showConfirmation&&c.success(x.successful_replace)}}).on("fileuploadchunkdone",function(e,t){var i=t.result;if(i.data&&i.data[0]){var r=i.data[0];E.removeItem(r),E.addItem(r,E.currentPath())}}).on("fileuploadfail",function(e,t){c.error(x.upload_failed)}),r.click()},Oe=function(e,t){var i=function(e,i){var r=i.getInputValue();return r?(r=te(r,"/")+"/",void t(r)):void c.error(x.prompt_foldername)},r=e.length,o=r>1?x.prompt_move_multiple.replace("%s",r):x.prompt_move;c.prompt({message:o,value:E.currentPath(),okBtn:{label:x.action_move,autoClose:!1,click:i},cancelBtn:{label:x.cancel},template:{dialogInput:'<input data-alertify-input type="text" value="" /><div class="prompt-info">'+x.help_move+"</div>"}})},Fe=function(t,i){return e.ajax({type:"GET",url:ge({mode:"copy",source:t.id,target:i}),dataType:"json",success:function(e){if(e.data){var t=e.data;E.addItem(t,i),alertify.clearDialogs(),C.options.showConfirmation&&c.success(x.successful_copied)}Y(e)},error:$})},Ee=function(t,i){return e.ajax({type:"GET",url:ge({mode:"move",old:t.id,"new":i}),dataType:"json",success:function(e){if(e.data){var r=e.data;E.removeItem(t),E.addItem(r,i),E.currentPath()===t.id&&E.itemsModel.loadList(r.id),E.previewFile()&&E.previewModel.rdo().id===t.id&&E.previewFile(!1),alertify.clearDialogs(),C.options.showConfirmation&&c.success(x.successful_moved)}Y(e)},error:$})},Ne=function(e,t){var i=e.length,r=i>1?x.confirm_delete_multiple.replace("%s",i):x.confirm_delete;c.confirm({message:r,okBtn:{label:x.yes,click:function(e,i){t()}},cancelBtn:{label:x.no}})},Ie=function(t){return e.ajax({type:"GET",url:ge({mode:"delete",path:t}),dataType:"json",success:function(e){if(e.data){var t=e.data;E.removeItem(t),E.previewFile()&&E.previewModel.rdo().id===t.id&&E.previewFile(!1),C.options.showConfirmation&&c.success(x.successful_delete)}Y(e)},error:$})},Te=function(t){var i={mode:"download",path:t.id};return e.ajax({type:"GET",url:ge(i),dataType:"json",success:function(t){t.data&&e.fileDownload(ge(i)),Y(t)},error:$})},Le=function(t){return e.ajax({type:"GET",url:ge({mode:"editfile",path:t.id}),dataType:"json",success:function(e){Y(e)},error:$})},Pe=function(t){e.ajax({type:"POST",url:ge(),dataType:"json",data:e("#fm-js-editor-form").serializeArray(),success:function(e){if(e.data){var t=e.data,i=E.previewModel,r=i.editor.content();i.rdo(t),i.viewer.content(r),i.closeEditor();var o=E.itemsModel.createObject(t),n=E.itemsModel.findByParam("id",t.id);E.itemsModel.objects.replace(n,o),c.success(x.successful_edit)}Y(e)},error:$})},Ue=function(t){return e.ajax({type:"GET",url:ge({mode:"getfile",path:t}),dataType:"json",success:function(e){Y(e)},error:$})},De=function(){e.ajax({type:"GET",url:ge({mode:"summarize"}),dataType:"json",success:function(t){if(t.data){var i=t.data.attributes,r=K(i.size,!0);if(i.sizeLimit>0){var o=K(i.sizeLimit,!0),n=100*i.size/i.sizeLimit,s=Math.round(100*n)/100;r+=" ("+s+"%) "+x.of+" "+o}E.summaryModel.files(i.files),E.summaryModel.folders(i.folders),E.summaryModel.size(r),E.summaryModel.enabled(!0);var a=e("#summary-popup").clone().show();E.summaryModel.enabled(!1),c.alert(a[0].outerHTML)}Y(t)},error:$})},ze=function(e){var t=function(t,i){var r=i.getInputValue();return r?(r=te(r,"/")+"/",void Ae(e,r)):void c.error(x.prompt_foldername)};c.prompt({message:x.prompt_extract,value:E.currentPath(),okBtn:{label:x.action_extract,autoClose:!1,click:t},cancelBtn:{label:x.cancel}})},Ae=function(t,i){e.ajax({type:"POST",url:ge(),data:{mode:"extract",source:t.id,target:i},dataType:"json",success:function(t){t.data&&(e.each(t.data,function(e,t){E.addItem(t,i)}),alertify.clearDialogs(),C.options.showConfirmation&&c.success(x.successful_extracted)),Y(t)},error:$})},Be=function(t,i,r){var o=r?r:[i];switch(t){case"select":Me(i);break;case"download":e.each(o,function(e,t){Te(t)});break;case"rename":Se(i);break;case"replace":_e(i);break;case"move":Oe(o,function(e){Ce(o,function(t,i){return Ee(i,e)})});break;case"delete":Ne(o,function(){Ce(o,function(e,t){return Ie(t.id)})});break;case"extract":ze(i);break;case"copy":E.clipboardModel.copy();break;case"cut":E.clipboardModel.cut()}},Re=function(){return C.options.browseOnly?!1:void(C.upload.multiple?(e("#file-input-container").remove(),k.unbind().click(function(){if(-1===_.indexOf("upload"))return c.error(x.NOT_ALLOWED),!1;var t=null,i=E.currentPath(),r=tmpl("tmpl-fileupload-container",{folder:x.current_folder+i,info:x.upload_files_number_limit.replace("%s",C.upload.maxNumberOfFiles)+" "+x.upload_file_size_limit.replace("%s",K(C.upload.fileSizeLimit,!0)),lang:x});"DISALLOW_ALL"==C.upload.policy&&(t=new RegExp("(\\.|\\/)("+C.upload.restrictions.join("|")+")$","i")),c.dialog({message:r,width:"auto",buttons:[{type:"ok",label:x.action_upload,autoClose:!1,click:function(e,t){n.children(".upload-item").length>0?n.find(".button-start").trigger("click"):c.error(x.upload_choose_file)}},{label:x.action_select,closeOnClick:!1,click:function(t,i){e("#fileupload",o).trigger("click")}},{type:"cancel",label:x.close}]});var o=e(".fm-fileupload-container"),n=e(".dropzone",o),s=e(".dropzone-wrapper",o),a=e("#total-progress",o).children();C.customScrollbar.enabled&&s.mCustomScrollbar({theme:C.customScrollbar.theme,scrollButtons:{enable:C.customScrollbar.button},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0},callbacks:{onOverflowY:function(){s.find(".mCSB_container").css({"margin-right":s.find(".mCSB_scrollTools").width()})},onOverflowYNone:function(){s.find(".mCSB_container").css({"margin-right":"auto"})}},axis:"y"}),s.on("click",function(t){(t.target===this||e(t.target).parent()[0]===this||t.target===n[0]||e(t.target).parent().hasClass("default-message"))&&e("#fileupload",o).trigger("click")}),n.on("click",".button-start",function(t){var i=e(this),r=i.parent().parent(),o=r.data();o.submit(),i.remove()}),n.on("click",".button-abort",function(t){var i=e(this),r=i.parent().parent(),o=r.data(),n=o.files[0].context;o.abort(),n.find(".error-message").text(x.upload_aborted),n.addClass("aborted")}),n.on("click",".button-resume",function(t){function r(i){e.blueimp.fileupload.prototype.options.add.call(e("#fileupload")[0],t,i),i.submit()}var o=e(this),n=o.parent().parent(),s=n.data(),a=s.files[0];if(a.chunkUploaded){var l=i+a.serverName;Ue(l).then(function(e){e.data&&(s.uploadedBytes=Number(e.data.attributes.size),s.uploadedBytes||(a.chunkUploaded=void 0),r(s))})}else r(s)}),n.on("click",".button-remove",function(t){var r=e(this),o=r.parent().parent(),n=o.data(),s=n.files[0];s.chunkUploaded&&Ie(i+s.serverName),r.closest(".upload-item").remove(),l()}),n.on("click",".button-info",function(t){var i=e(this),r=i.closest(".upload-item");if(r.hasClass("error")){var o=r.find(".error-message");c.error(o.text())}});var l=function(){n.children(".upload-item").length>0?n.addClass("started"):n.removeClass("started")};e("#fileupload",o).fileupload({autoUpload:!1,sequentialUploads:!0,dataType:"json",dropZone:n,maxChunkSize:C.upload.chunkSize,url:ge(),paramName:"files",singleFileUploads:!0,formData:{mode:"upload",path:i},maxNumberOfFiles:C.upload.maxNumberOfFiles,acceptFileTypes:t,maxFileSize:C.upload.fileSizeLimit,messages:{maxNumberOfFiles:x.upload_files_number_limit.replace("%s",C.upload.maxNumberOfFiles),acceptFileTypes:x.upload_file_type_invalid,maxFileSize:x.upload_file_too_big+" "+x.upload_file_size_limit.replace("%s",K(C.upload.fileSizeLimit,!0))},previewMaxHeight:120,previewMaxWidth:120,previewCrop:!0}).on("fileuploadadd",function(t,i){var r=n.children(".upload-item");e.each(i.files,function(t,o){if(r.length>=C.upload.maxNumberOfFiles)return c.error(x.upload_files_number_limit.replace("%s",C.upload.maxNumberOfFiles),{logClass:"fileuploadadd",unique:!0}),!1;o.formattedSize=K(o.size);var s=e(tmpl("tmpl-upload-item",{file:o,lang:x,imagesPath:c.settings.baseUrl+"/scripts/jQuery-File-Upload/img"}));o.context=s,s.find(".buttons").data(i),s.appendTo(n)}),l()}).on("fileuploadsend",function(t,i){e.each(i.files,function(e,t){var r=t.context;r.removeClass("added aborted error").addClass("process"),t.chunkUploaded&&i.total===i.uploadedBytes&&r.remove()})}).on("fileuploadfail",function(t,i){e.each(i.files,function(e,t){t.error=x.upload_failed;var i=t.context;i.removeClass("added process").addClass("error")})}).on("fileuploaddone",function(t,i){var r=i.result;e.each(i.files,function(e,t){var i=t.context;r&&r.errors?(i.removeClass("added process").addClass("error"),i.find(".error-message").text(V(r.errors[0])),i.find(".button-start").remove()):i.remove()})}).on("fileuploadalways",function(t,i){var r=i.result;e.each(i.files,function(e,t){if(r&&r.data&&r.data[e]){var i=r.data[e];E.removeItem(i),E.addItem(i,E.currentPath())}});var o=n.children(".upload-item");0===o.filter(".added").length&&0===o.filter(".process").length&&(0===o.length&&(alertify.clearDialogs(),C.options.showConfirmation&&c.success(x.upload_successful_files)),o.filter(".error").length&&c.error(x.upload_partially+"<br>"+x.upload_failed_details)),l()}).on("fileuploadchunkdone",function(t,i){var r=i.result;e.each(i.files,function(e,t){if(r.data&&r.data[e]){var i=r.data[e];E.removeItem(i),E.addItem(i,E.currentPath()),t.serverName=i.attributes.name,t.chunkUploaded=1}})}).on("fileuploadprocessalways",function(t,i){e.each(i.files,function(e,t){var i=t.context;"undefined"!=typeof i&&(t.preview&&(i.find(".image").append(t.preview),i.find(".preview").removeClass("file-preview").addClass("image-preview")),t.error&&(i.removeClass("added process").addClass("error"),i.find(".error-message").text(t.error),i.find(".button-start").remove()))})}).on("fileuploadprogress",function(t,i){e.each(i.files,function(e,t){var r=t.context,o=parseInt(i.loaded/i.total*100,10);r.find(".progress-bar").css("width",o+"%")})}).on("fileuploadprogressall",function(e,t){var i=parseInt(t.loaded/t.total*100,10);a.css("width",i+"%")})})):(k.click(function(){if(-1===_.indexOf("upload"))return c.error(x.NOT_ALLOWED),!1;var t=e(this).data();e.isEmptyObject(t)?c.error(x.upload_choose_file):t.submit()}),h.fileupload({autoUpload:!1,dataType:"json",url:ge(),paramName:"files",maxChunkSize:C.upload.chunkSize}).on("fileuploadadd",function(e,t){k.data(t)}).on("fileuploadsubmit",function(e,t){t.formData={mode:"upload",path:E.currentPath()},k.addClass("loading").prop("disabled",!0),k.children("span").text(x.loading_data)}).on("fileuploadalways",function(t,i){e("#filepath").val(""),k.removeData().removeClass("loading").prop("disabled",!1),k.children("span").text(x.action_upload);var r=i.result;if(r&&r.errors&&c.error(x.upload_failed+"<br>"+V(r.errors[0])),r&&r.data){var o=r.data[0];E.removeItem(o),E.addItem(o,E.currentPath()),C.options.showConfirmation&&c.success(x.upload_successful_file)}}).on("fileuploadchunkdone",function(e,t){var i=t.result;if(i.data&&i.data[0]){var r=i.data[0];E.removeItem(r),E.addItem(r,E.currentPath())}}).on("fileuploadfail",function(e,t){c.error(x.upload_failed)})))};L(),e(window).resize(c.setDimensions)}}(jQuery),$.fn.richFilemanager=function(e){return this.each(function(){if(void 0==$(this).data("richFilemanager")){
var t=new $.richFilemanagerPlugin(this,e);$(this).data("richFilemanager",t)}})},window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""));